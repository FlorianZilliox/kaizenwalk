<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaizenWalk</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #000000;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            padding-top: 60px;
        }
        
        .status-display {
            text-align: center;
            padding-bottom: 20px;
        }
        
        .status-text {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .set-info {
            font-size: 20px;
            color: #666;
            min-height: 20px;
        }
        
        .timer-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .progress-ring {
            position: relative;
            width: 280px;
            height: 280px;
        }
        
        .timer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .time-text {
            font-size: 48px;
            font-weight: bold;
            font-variant-numeric: tabular-nums;
            letter-spacing: 2px;
            color: #00FFFF;
        }
        
        .controls {
            padding: 60px 40px;
            text-align: center;
        }
        
        .button {
            background-color: #00FFFF;
            color: #000000;
            border: none;
            padding: 20px 60px;
            border-radius: 50px;
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 1px;
            min-width: 200px;
            cursor: pointer;
            transition: transform 0.1s ease;
            box-shadow: 0 4px 8px rgba(0, 255, 255, 0.3);
        }
        
        .button:active {
            transform: scale(0.95);
        }
        
        .button.stop {
            background-color: #FF00FF;
            color: #ffffff;
            box-shadow: 0 4px 8px rgba(255, 0, 255, 0.3);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-display">
            <div class="status-text" id="statusText">Ready to start</div>
            <div class="set-info" id="setInfo"></div>
        </div>
        
        <div class="timer-container">
            <div class="progress-ring">
                <svg width="280" height="280">
                    <circle cx="140" cy="140" r="136" stroke="#333" stroke-width="8" fill="transparent"/>
                    <circle 
                        cx="140" 
                        cy="140" 
                        r="136" 
                        stroke="#00FFFF" 
                        stroke-width="8" 
                        fill="transparent"
                        stroke-dasharray="854.513"
                        stroke-dashoffset="0"
                        stroke-linecap="round"
                        id="progressCircle"
                        transform="rotate(-90 140 140)"
                        style="transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;"
                    />
                </svg>
                <div class="timer-content">
                    <div class="time-text" id="timeText">30:00</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button class="button" id="startButton">START</button>
        </div>
    </div>

    <script>
        console.log('🚀 KaizenWalk starting...');
        
        // Variables globales
        let isRunning = false;
        let startTime = null;
        let elapsedTime = 0;
        let timerInterval = null;
        let lastInterval = -1;
        
        // Configuration
        const TOTAL_DURATION = 30 * 60; // 30 minutes
        const INTERVAL_DURATION = 3 * 60; // 3 minutes
        
        // Elements DOM
        const statusText = document.getElementById('statusText');
        const setInfo = document.getElementById('setInfo');
        const timeText = document.getElementById('timeText');
        const progressCircle = document.getElementById('progressCircle');
        const startButton = document.getElementById('startButton');
        
        // Fonction pour formater le temps
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }
        
        // Fonction principale du timer
        function updateTimer() {
            const now = Date.now();
            elapsedTime = Math.floor((now - startTime) / 1000);
            
            // Calculer temps restant
            const remaining = TOTAL_DURATION - elapsedTime;
            timeText.textContent = formatTime(remaining);
            
            // Calculer intervalle actuel
            const currentInterval = Math.floor(elapsedTime / INTERVAL_DURATION);
            const isFast = currentInterval % 2 === 0;
            
            // Mettre à jour le statut
            statusText.textContent = isFast ? 'Fast Walk' : 'Slow Walk';
            statusText.style.color = '#ffffff';
            
            // Couleur du timer
            timeText.style.color = isFast ? '#00FFFF' : '#FF00FF';
            
            // Effet pulse pour Fast Walk
            if (isFast) {
                timeText.classList.add('pulse');
            } else {
                timeText.classList.remove('pulse');
            }
            
            // Informations sets
            if (currentInterval >= 0 && currentInterval < 10) {
                const setNumber = Math.floor(currentInterval / 2) + 1;
                const setsRemaining = 5 - setNumber;
                setInfo.textContent = `Set ${setNumber}/5 • ${setsRemaining} sets remaining`;
            }
            
            // Cercle de progression (se vide progressivement du haut vers la droite)
            const intervalProgress = (elapsedTime % INTERVAL_DURATION) / INTERVAL_DURATION;
            const circumference = 2 * Math.PI * 136;
            const offset = -circumference * intervalProgress; // Négatif pour sens des aiguilles
            progressCircle.style.strokeDashoffset = offset;
            progressCircle.style.stroke = isFast ? '#00FFFF' : '#FF00FF';
            
            // Vérifier changement d'intervalle
            if (currentInterval !== lastInterval && currentInterval < 10) {
                if (lastInterval !== -1) {
                    // Nouveau son simple
                    playBeep(isFast);
                    
                    // Vibration
                    if (navigator.vibrate) {
                        navigator.vibrate(isFast ? [100, 50, 100] : [200]);
                    }
                }
                lastInterval = currentInterval;
            }
            
            // Vérifier si terminé
            if (elapsedTime >= TOTAL_DURATION) {
                completeTimer();
            }
        }
        
        // Sons musicaux avec accords et mélodies
        function playBeep(isFast) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (isFast) {
                    // Fast Walk : mélodie ascendante joyeuse (Do-Mi-Sol)
                    const melody = [523.25, 659.25, 783.99]; // C5, E5, G5
                    melody.forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        
                        osc.frequency.value = freq;
                        osc.type = 'sine';
                        
                        const startTime = audioContext.currentTime + (i * 0.3);
                        gain.gain.setValueAtTime(0.6, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.5);
                        
                        osc.start(startTime);
                        osc.stop(startTime + 0.5);
                    });
                } else {
                    // Slow Walk : accord grave et profond (accord mineur)
                    const chord = [261.63, 311.13, 392.00]; // C4, Eb4, G4 (accord de Do mineur)
                    chord.forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        
                        osc.frequency.value = freq;
                        osc.type = 'triangle'; // Son plus chaud pour l'accord
                        
                        const startTime = audioContext.currentTime;
                        gain.gain.setValueAtTime(0.4, startTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, startTime + 1.2);
                        
                        osc.start(startTime);
                        osc.stop(startTime + 1.2);
                    });
                }
            } catch (e) {
                console.log('Audio not available');
            }
        }
        
        // Démarrer le timer
        function startTimer() {
            console.log('▶️ Starting timer');
            isRunning = true;
            startTime = Date.now();
            elapsedTime = 0;
            lastInterval = -1;
            
            startButton.textContent = 'STOP';
            startButton.className = 'button stop';
            
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer(); // Première mise à jour immédiate
        }
        
        // Arrêter le timer
        function stopTimer() {
            console.log('⏹️ Stopping timer');
            isRunning = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            startButton.textContent = 'START';
            startButton.className = 'button';
            
            // Reset affichage
            statusText.textContent = 'Ready to start';
            statusText.style.color = '#666';
            setInfo.textContent = '';
            timeText.textContent = '30:00';
            timeText.style.color = '#00FFFF';
            timeText.classList.remove('pulse');
            
            // Reset cercle (plein au début)
            const circumference = 2 * Math.PI * 136;
            progressCircle.style.strokeDashoffset = 0; // Commence plein
            progressCircle.style.stroke = '#00FFFF';
        }
        
        // Compléter le timer
        function completeTimer() {
            console.log('🎉 Timer completed');
            isRunning = false;
            
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            statusText.textContent = 'Complete!';
            statusText.style.color = '#00FFFF';
            
            startButton.textContent = 'START';
            startButton.className = 'button';
            
            // Son de fin : fanfare triomphale
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Mélodie de victoire : Do-Do-Do-Sol-La-La-La-Sol-Fa-Fa-Fa-Mi-Mi-Do
                const victoryMelody = [
                    523.25, 523.25, 523.25, 783.99, // Do-Do-Do-Sol
                    880.00, 880.00, 880.00, 783.99, // La-La-La-Sol
                    698.46, 698.46, 698.46, 659.25, // Fa-Fa-Fa-Mi
                    659.25, 523.25 // Mi-Do
                ];
                
                victoryMelody.forEach((freq, i) => {
                    const osc = audioContext.createOscillator();
                    const gain = audioContext.createGain();
                    
                    osc.connect(gain);
                    gain.connect(audioContext.destination);
                    
                    osc.frequency.value = freq;
                    osc.type = 'sine';
                    
                    const startTime = audioContext.currentTime + (i * 0.15);
                    gain.gain.setValueAtTime(0.5, startTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, startTime + 0.3);
                    
                    osc.start(startTime);
                    osc.stop(startTime + 0.3);
                });
            } catch (e) {
                console.log('Audio not available');
            }
            
            // Vibration de fin
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200]);
            }
        }
        
        // Gestionnaire de bouton
        startButton.addEventListener('click', function() {
            console.log('🔄 Button clicked, isRunning:', isRunning);
            if (isRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        });
        
        console.log('✅ KaizenWalk ready');
    </script>
</body>
</html>